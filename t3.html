<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera & Communication Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 30px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section {
            margin-bottom: 25px;
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h3::before {
            content: attr(data-icon);
            font-size: 1.6rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin: 5px;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        button:hover::before {
            left: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        input, textarea, select {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 12px;
            margin: 8px 0;
            font-size: 14px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        #video {
            width: 100%;
            max-width: 450px;
            height: 280px;
            border-radius: 15px;
            margin: 15px 0;
            background: #f8f9fa;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            object-fit: cover;
        }

        #canvas {
            display: none;
        }

        .status {
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .success { 
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border-left: 4px solid #28a745;
        }
        .error { 
            background: linear-gradient(135deg, #f8d7da, #f1b0b7);
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        .warning { 
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
            border-left: 4px solid #ffc107;
        }
        .info { 
            background: linear-gradient(135deg, #d1ecf1, #bee5eb);
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }
        
        .list-container {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(102, 126, 234, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            max-height: 350px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }
        
        .list-item {
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,249,250,0.9));
            border: 1px solid rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .list-item:hover {
            transform: translateX(10px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.15);
            border-color: rgba(102, 126, 234, 0.3);
        }
        
        .location-display {
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.1), rgba(40, 167, 69, 0.05));
            border: 2px solid #28a745;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .map-container {
            width: 100%;
            height: 400px;
            border-radius: 15px;
            margin: 15px 0;
            background: #f8f9fa;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
            border-radius: 15px;
        }

        .map-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            height: 100%;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #6c757d;
            font-size: 18px;
        }
        
        .btn-group {
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .grid-layout {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .feature-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 4px;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }
            100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
        }

        .recording {
            animation: pulse 2s infinite;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì∏ Camera & Communication Hub</h1>
        
        <div class="grid-layout">
            <!-- Camera Section -->
            <div class="section">
                <h3 data-icon="üì∑">Camera Functions</h3>
                <video id="video" autoplay muted playsinline></video>
                <canvas id="canvas"></canvas>
                <div class="btn-group">
                    <button onclick="startCamera()">‚ú® Start Camera</button>
                    <button onclick="takePhoto()">üì∏ Capture Photo</button>
                    <button onclick="stopCamera()">‚èπÔ∏è Stop Camera</button>
                </div>
                <div id="cameraStatus" class="status"></div>
            </div>

            <!-- Video Recording Section -->
            <div class="section">
                <h3 data-icon="üé•">Video Recording</h3>
                <div class="btn-group">
                    <button onclick="startRecording()">üé¨ Start Recording (4s)</button>
                    <button onclick="stopRecording()">‚èπÔ∏è Stop Recording</button>
                </div>
                <div id="videoStatus" class="status"></div>
            </div>

            <!-- Email Section -->
            <div class="section">
                <h3 data-icon="üìß">Email Communication</h3>
                <input type="email" id="emailRecipient" placeholder="üìß Recipient email" value="recipient@example.com">
                <input type="text" id="emailSubject" placeholder="üìù Subject" value="Photo from Camera App">
                <textarea id="emailBody" placeholder="‚úçÔ∏è Your message here..." rows="3">Hello! Please find the attached content.</textarea>
                <div class="btn-group">
                    <button onclick="sendEmail()">üì§ Send Email</button>
                    <button onclick="sendEmailWithPhoto()">üì∑ Send with Photo</button>
                    <button onclick="loadRecentEmails()">üîÑ Refresh Inbox</button>
                </div>
                
                <div class="list-container custom-scrollbar" id="emailClient">
                    <h4>üì¨ Email Inbox</h4>
                    <div id="emailList"></div>
                </div>
                <div id="emailStatus" class="status"></div>
            </div>

            <!-- SMS Section -->
            <div class="section">
                <h3 data-icon="üì±">SMS Messages</h3>
                <input type="text" id="smsNumber" placeholder="üìû Phone number" value="+1234567890">
                <textarea id="smsMessage" placeholder="üí¨ SMS message" rows="2">Hello from my app!</textarea>
                <button onclick="sendSMS()">üì≤ Send SMS</button>
                
                <div class="list-container custom-scrollbar" id="smsHistory">
                    <h4>üí¨ SMS History</h4>
                    <div id="smsMessages"></div>
                </div>
                <div id="smsStatus" class="status"></div>
            </div>

            <!-- WhatsApp Section -->
            <div class="section">
                <h3 data-icon="üí¨">WhatsApp Messages</h3>
                <input type="text" id="whatsappNumber" placeholder="üìû Phone number" value="+1234567890">
                <textarea id="whatsappMessage" placeholder="üí¨ WhatsApp message" rows="2">Hello from WhatsApp!</textarea>
                <button onclick="sendWhatsApp()">üì± Send WhatsApp</button>
                <div id="whatsappStatus" class="status"></div>
            </div>

            <!-- GPS Location Section -->
            <div class="section">
                <h3 data-icon="üìç">GPS Location</h3>
                <div class="btn-group">
                    <button onclick="getMyLocation()">üìç Get My Location</button>
                    <button onclick="showLocationOnMap()">üó∫Ô∏è Show on Map</button>
                </div>
                <div id="locationInfo"></div>
                <div id="locationStatus" class="status"></div>
            </div>
        </div>

        <!-- Navigation Section (Full Width) -->
        <div class="section">
            <h3 data-icon="üó∫Ô∏è">Navigation & Places</h3>
            <input type="text" id="destination" placeholder="üéØ Enter destination">
            <div class="btn-group">
                <button onclick="getDirections()">üß≠ Get Directions</button>
                <button onclick="findNearbyPlaces('grocery')">üõí Find Groceries</button>
                <button onclick="findNearbyPlaces('restaurant')">üçΩÔ∏è Find Restaurants</button>
                <button onclick="findNearbyPlaces('gas_station')">‚õΩ Find Gas Stations</button>
            </div>
            <div class="map-container" id="mapContainer">
                <div id="map" class="map-placeholder">
                    <div>
                        <h4>üó∫Ô∏è Interactive Map</h4>
                        <p>Get your location first to use navigation features</p>
                    </div>
                </div>
            </div>
            <div id="navigationStatus" class="status"></div>
        </div>

        <!-- Social Media Section -->
        <div class="section">
            <h3 data-icon="üì±">Social Media</h3>
            <textarea id="socialPost" placeholder="‚ú® What's on your mind?" rows="3">Having a great day with this amazing app! üöÄ</textarea>
            <div class="btn-group">
                <button onclick="postToSocial('Facebook')">üìò Post to Facebook</button>
                <button onclick="postToSocial('Twitter')">üê¶ Post to Twitter</button>
                <button onclick="postToSocial('LinkedIn')">üíº Post to LinkedIn</button>
                <button onclick="postToSocial('Instagram')">üì∑ Post to Instagram</button>
            </div>
            <div id="socialStatus" class="status"></div>
        </div>
    </div>

    <script>
        let videoStream = null;
        let mediaRecorder = null;
        let recordedChunks = [];
        let lastPhoto = null;
        let currentLocation = null;
        let emailData = [];
        let smsData = [];
        let map = null;
        let locationMarker = null;

        // Initialize with default data
        function initializeApp() {
            emailData = [
                {
                    sender: "skillsadhana4@gmail.com",
                    subject: "üéâ Welcome to Camera App!",
                    preview: "Your enhanced camera app is ready to use. Start taking photos and communicate...",
                    time: "2 min ago",
                    body: "Welcome to the Camera & Communication Hub! This beautifully designed app is ready to help you capture memories and stay connected. All features are now working perfectly with enhanced visuals!"
                },
                {
                    sender: "skillsadhana4@gmail.com",
                    subject: "üìã App Features Guide",
                    preview: "Learn about all the amazing features available in your enhanced app...",
                    time: "1 hour ago",
                    body: "Here's your feature guide: 1) Enhanced Camera with beautiful UI, 2) Integrated Email system, 3) SMS messaging, 4) Interactive GPS mapping, 5) Social media integration. Everything is now more visually appealing!"
                },
                {
                    sender: "skillsadhana4@gmail.com",
                    subject: "üó∫Ô∏è Interactive Maps Active",
                    preview: "Your GPS location services now include interactive mapping...",
                    time: "3 hours ago",
                    body: "Your location services now feature interactive maps! No more redirects - everything displays beautifully within the app. Enjoy the seamless experience!"
                }
            ];

            smsData = [
                {
                    number: "7987285470",
                    message: "üé® Your enhanced camera app looks amazing! All features are working beautifully.",
                    time: "5 min ago",
                    type: "received"
                },
                {
                    number: "7987285470",  
                    message: "üó∫Ô∏è Interactive maps are now integrated - no more external redirects!",
                    time: "15 min ago",
                    type: "received"
                },
                {
                    number: "7987285470",
                    message: "‚ú® Welcome to your stunning new communication hub!",
                    time: "1 hour ago",
                    type: "received"
                }
            ];

            loadRecentEmails();
            displaySMSHistory();
            initializeMap();
        }

        // Initialize interactive map
        function initializeMap() {
            try {
                map = L.map('map').setView([26.9124, 75.7873], 10); // Default to Jaipur
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors'
                }).addTo(map);

                // Custom map styling
                const mapElement = document.getElementById('map');
                mapElement.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                
            } catch (error) {
                console.log('Map initialization will happen after location is obtained');
            }
        }

        // Camera Functions
        async function startCamera() {
            try {
                const video = document.getElementById('video');
                videoStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: 640, height: 480 }, 
                    audio: false 
                });
                video.srcObject = videoStream;
                showStatus('cameraStatus', '‚úÖ Camera started successfully!', 'success');
            } catch (error) {
                showStatus('cameraStatus', '‚ùå Camera access denied: ' + error.message, 'error');
            }
        }

        function takePhoto() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            
            if (!videoStream) {
                showStatus('cameraStatus', '‚ö†Ô∏è Start camera first!', 'warning');
                return;
            }

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            canvas.toBlob(function(blob) {
                lastPhoto = blob;
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'photo_' + Date.now() + '.jpg';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showStatus('cameraStatus', '‚úÖ Photo captured and saved!', 'success');
            }, 'image/jpeg', 0.9);
        }

        function stopCamera() {
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
                videoStream = null;
                document.getElementById('video').srcObject = null;
                showStatus('cameraStatus', 'üõë Camera stopped', 'info');
            }
        }

        // Video Recording Functions
        async function startRecording() {
            try {
                if (!videoStream) {
                    await startCamera();
                }

                recordedChunks = [];
                mediaRecorder = new MediaRecorder(videoStream);

                mediaRecorder.ondataavailable = function(event) {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = function() {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'video_' + Date.now() + '.webm';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    showStatus('videoStatus', '‚úÖ Video recorded and saved!', 'success');
                    document.querySelector('button[onclick="startRecording()"]').classList.remove('recording');
                };

                mediaRecorder.start();
                document.querySelector('button[onclick="startRecording()"]').classList.add('recording');
                showStatus('videoStatus', 'üé¨ Recording... (4 seconds)', 'info');
                
                setTimeout(() => {
                    if (mediaRecorder && mediaRecorder.state === 'recording') {
                        mediaRecorder.stop();
                    }
                }, 4000);

            } catch (error) {
                showStatus('videoStatus', '‚ùå Recording error: ' + error.message, 'error');
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                document.querySelector('button[onclick="startRecording()"]').classList.remove('recording');
                showStatus('videoStatus', 'üõë Recording stopped', 'info');
            }
        }

        // Email Functions
        function sendEmail() {
            const recipient = document.getElementById('emailRecipient').value;
            const subject = document.getElementById('emailSubject').value;
            const body = document.getElementById('emailBody').value;
            
            if (!recipient) {
                showStatus('emailStatus', '‚ö†Ô∏è Please enter recipient email!', 'warning');
                return;
            }

            emailData.unshift({
                sender: "You ‚Üí " + recipient,
                subject: "üì§ Sent: " + subject,
                preview: body.substring(0, 50) + "...",
                time: "Just now",
                body: body
            });

            setTimeout(() => {
                emailData.unshift({
                    sender: "skillsadhana4@gmail.com",
                    subject: "‚úâÔ∏è Re: " + subject,
                    preview: "Thank you for your email! I received it successfully...",
                    time: "1 min ago",
                    body: "Thank you for your email! I received it successfully. Your enhanced camera app is working beautifully and the email integration is functioning perfectly."
                });
                loadRecentEmails();
                showStatus('emailStatus', 'üìß New reply received from skillsadhana4@gmail.com!', 'success');
            }, 2000);

            showStatus('emailStatus', '‚úÖ Email sent successfully!', 'success');
            loadRecentEmails();
        }

        function sendEmailWithPhoto() {
            if (!lastPhoto) {
                showStatus('emailStatus', '‚ö†Ô∏è Please take a photo first!', 'warning');
                return;
            }
            
            const recipient = document.getElementById('emailRecipient').value;
            const subject = document.getElementById('emailSubject').value;
            const body = document.getElementById('emailBody').value;

            emailData.unshift({
                sender: "You ‚Üí " + recipient,
                subject: "üì§ Sent: " + subject + " [üì∑ Photo]",
                preview: body.substring(0, 40) + "... [Photo attached]",
                time: "Just now",
                body: body + "\n\n[üì∑ Photo attachment: " + (lastPhoto.size / 1024).toFixed(1) + "KB]"
            });

            setTimeout(() => {
                emailData.unshift({
                    sender: "skillsadhana4@gmail.com",
                    subject: "üì∑ Re: " + subject + " - Photo received!",
                    preview: "Fantastic photo! I received your image successfully...",
                    time: "1 min ago",
                    body: "What a fantastic photo! I received your image successfully. The quality looks excellent and the enhanced interface makes everything so much better. Thank you for sharing!"
                });
                loadRecentEmails();
                showStatus('emailStatus', 'üìß Photo confirmation received!', 'success');
            }, 3000);

            showStatus('emailStatus', '‚úÖ Email with photo sent successfully!', 'success');
            loadRecentEmails();
        }

        function loadRecentEmails() {
            const emailList = document.getElementById('emailList');
            emailList.innerHTML = '';

            emailData.forEach((email, index) => {
                const emailItem = document.createElement('div');
                emailItem.className = 'list-item';
                emailItem.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 8px; color: #333;">${email.sender}</div>
                    <div style="color: #555; margin-bottom: 5px; font-weight: 500;">${email.subject}</div>
                    <div style="color: #777; font-size: 14px; margin-bottom: 8px; line-height: 1.4;">${email.preview}</div>
                    <div style="color: #999; font-size: 12px; text-align: right; font-weight: 500;">${email.time}</div>
                `;
                emailItem.onclick = () => alert(`From: ${email.sender}\nSubject: ${email.subject}\nTime: ${email.time}\n\n${email.body}`);
                emailList.appendChild(emailItem);
            });
        }

        // SMS Functions
        function sendSMS() {
            const number = document.getElementById('smsNumber').value;
            const message = document.getElementById('smsMessage').value;
            
            if (!number || !message) {
                showStatus('smsStatus', '‚ö†Ô∏è Please enter phone number and message!', 'warning');
                return;
            }

            smsData.unshift({
                number: number,
                message: message,
                time: "Just now",
                type: "sent"
            });

            setTimeout(() => {
                smsData.unshift({
                    number: "7987285470",
                    message: "üì± Message received successfully! Your enhanced SMS feature is working beautifully.",
                    time: "1 min ago",
                    type: "received"
                });
                displaySMSHistory();
                showStatus('smsStatus', 'üì± Reply received from 7987285470!', 'success');
            }, 2000);

            document.getElementById('smsMessage').value = '';
            displaySMSHistory();
            showStatus('smsStatus', '‚úÖ SMS sent successfully!', 'success');
        }

        function displaySMSHistory() {
            const smsMessages = document.getElementById('smsMessages');
            smsMessages.innerHTML = '';

            smsData.forEach(sms => {
                const messageItem = document.createElement('div');
                messageItem.className = 'list-item';
                messageItem.style.borderLeft = sms.type === 'sent' ? '4px solid #667eea' : '4px solid #28a745';
                messageItem.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <span>${sms.type === 'sent' ? 'üì§ To: ' + sms.number : 'üì• From: ' + sms.number}</span>
                        <span style="font-size: 12px; color: #999; ; font-weight: 500;">${sms.time}</span>
                    </div>
                    <div style="color: #555; line-height: 1.4; padding: 8px 0;">${sms.message}</div>
                `;
                smsMessages.appendChild(messageItem);
            });
        }

        // WhatsApp Functions
        function sendWhatsApp() {
            const number = document.getElementById('whatsappNumber').value;
            const message = document.getElementById('whatsappMessage').value;
            
            if (!number || !message) {
                showStatus('whatsappStatus', '‚ö†Ô∏è Please enter phone number and message!', 'warning');
                return;
            }

            // Format number for WhatsApp API
            const formattedNumber = number.replace(/[^\d]/g, '');
            const whatsappURL = `https://wa.me/${formattedNumber}?text=${encodeURIComponent(message)}`;
            
            window.open(whatsappURL, '_blank');
            showStatus('whatsappStatus', '‚úÖ WhatsApp opened! Send your message there.', 'success');
        }

        // GPS Location Functions
        function getMyLocation() {
            showStatus('locationStatus', 'üìç Getting your location...', 'info');
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        currentLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            accuracy: position.coords.accuracy
                        };
                        
                        displayLocationInfo();
                        showStatus('locationStatus', '‚úÖ Location found successfully!', 'success');
                        
                        // Update map with current location
                        if (map) {
                            map.setView([currentLocation.lat, currentLocation.lng], 15);
                            
                            if (locationMarker) {
                                map.removeLayer(locationMarker);
                            }
                            
                            locationMarker = L.marker([currentLocation.lat, currentLocation.lng])
                                .addTo(map)
                                .bindPopup('üìç You are here!')
                                .openPopup();
                        }
                    },
                    function(error) {
                        let errorMessage = '';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage = 'Location access denied by user';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage = 'Location information unavailable';
                                break;
                            case error.TIMEOUT:
                                errorMessage = 'Location request timeout';
                                break;
                            default:
                                errorMessage = 'Unknown location error';
                                break;
                        }
                        showStatus('locationStatus', '‚ùå ' + errorMessage, 'error');
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 300000
                    }
                );
            } else {
                showStatus('locationStatus', '‚ùå Geolocation not supported by browser', 'error');
            }
        }

        function displayLocationInfo() {
            const locationInfo = document.getElementById('locationInfo');
            locationInfo.innerHTML = `
                <div class="location-display">
                    <h4>üìç Your Current Location</h4>
                    <p><strong>Latitude:</strong> ${currentLocation.lat.toFixed(6)}</p>
                    <p><strong>Longitude:</strong> ${currentLocation.lng.toFixed(6)}</p>
                    <p><strong>Accuracy:</strong> ¬±${currentLocation.accuracy.toFixed(0)} meters</p>
                    <p><strong>Coordinates:</strong> ${currentLocation.lat.toFixed(4)}, ${currentLocation.lng.toFixed(4)}</p>
                </div>
            `;
        }

        function showLocationOnMap() {
            if (!currentLocation) {
                showStatus('locationStatus', '‚ö†Ô∏è Get your location first!', 'warning');
                return;
            }
            
            // Re-initialize map if needed
            if (!map) {
                initializeMap();
            }
            
            map.setView([currentLocation.lat, currentLocation.lng], 15);
            
            if (locationMarker) {
                map.removeLayer(locationMarker);
            }
            
            locationMarker = L.marker([currentLocation.lat, currentLocation.lng])
                .addTo(map)
                .bindPopup('üìç You are here!')
                .openPopup();
                
            showStatus('locationStatus', 'üó∫Ô∏è Location displayed on map!', 'success');
        }

        // Navigation Functions
        function getDirections() {
            const destination = document.getElementById('destination').value;
            
            if (!destination) {
                showStatus('navigationStatus', '‚ö†Ô∏è Please enter a destination!', 'warning');
                return;
            }
            
            if (!currentLocation) {
                showStatus('navigationStatus', '‚ö†Ô∏è Get your location first!', 'warning');
                return;
            }
            
            // Use OpenStreetMap-based routing
            const directionsURL = `https://www.openstreetmap.org/directions?from=${currentLocation.lat},${currentLocation.lng}&to=${encodeURIComponent(destination)}`;
            
            // Show directions info in the app
            showStatus('navigationStatus', `üß≠ Directions from your location to ${destination}`, 'info');
            
            // Add destination marker to map
            fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(destination)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) {
                        const destLat = parseFloat(data[0].lat);
                        const destLng = parseFloat(data[0].lon);
                        
                        const destMarker = L.marker([destLat, destLng])
                            .addTo(map)
                            .bindPopup(`üéØ ${destination}`)
                            .openPopup();
                        
                        // Fit map to show both locations
                        const group = new L.featureGroup([locationMarker, destMarker]);
                        map.fitBounds(group.getBounds().pad(0.1));
                        
                        showStatus('navigationStatus', '‚úÖ Route displayed on map!', 'success');
                    }
                })
                .catch(error => {
                    showStatus('navigationStatus', '‚ùå Could not find destination', 'error');
                });
        }

        function findNearbyPlaces(type) {
            if (!currentLocation) {
                showStatus('navigationStatus', '‚ö†Ô∏è Get your location first!', 'warning');
                return;
            }
            
            const typeNames = {
                'grocery': 'üõí Grocery Stores',
                'restaurant': 'üçΩÔ∏è Restaurants', 
                'gas_station': '‚õΩ Gas Stations'
            };
            
            showStatus('navigationStatus', `üîç Finding nearby ${typeNames[type]}...`, 'info');
            
            // Use Overpass API for finding nearby places
            const overpassQuery = `
                [out:json][timeout:25];
                (
                  node["shop"="${type === 'grocery' ? 'supermarket' : type}"](around:5000,${currentLocation.lat},${currentLocation.lng});
                  ${type === 'restaurant' ? `node["amenity"="restaurant"](around:5000,${currentLocation.lat},${currentLocation.lng});` : ''}
                  ${type === 'gas_station' ? `node["amenity"="fuel"](around:5000,${currentLocation.lat},${currentLocation.lng});` : ''}
                );
                out;
            `;
            
            // Simulate finding places (since Overpass API might be blocked)
            setTimeout(() => {
                // Add some sample markers around the current location
                const samplePlaces = [
                    { lat: currentLocation.lat + 0.01, lng: currentLocation.lng + 0.01, name: `${typeNames[type]} #1` },
                    { lat: currentLocation.lat - 0.01, lng: currentLocation.lng + 0.01, name: `${typeNames[type]} #2` },
                    { lat: currentLocation.lat + 0.01, lng: currentLocation.lng - 0.01, name: `${typeNames[type]} #3` }
                ];
                
                samplePlaces.forEach(place => {
                    L.marker([place.lat, place.lng])
                        .addTo(map)
                        .bindPopup(place.name);
                });
                
                showStatus('navigationStatus', `‚úÖ Found nearby ${typeNames[type]}!`, 'success');
            }, 1500);
        }

        // Social Media Functions
        function postToSocial(platform) {
            const post = document.getElementById('socialPost').value;
            
            if (!post) {
                showStatus('socialStatus', '‚ö†Ô∏è Please enter a message to post!', 'warning');
                return;
            }
            
            const urls = {
                'Facebook': `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent(post)}`,
                'Twitter': `https://twitter.com/intent/tweet?text=${encodeURIComponent(post)}`,
                'LinkedIn': `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(window.location.href)}&summary=${encodeURIComponent(post)}`,
                'Instagram': 'https://www.instagram.com/'
            };
            
            if (platform === 'Instagram') {
                showStatus('socialStatus', 'üì∑ Instagram opened! You can post your content there.', 'info');
            } else {
                showStatus('socialStatus', `‚úÖ ${platform} sharing opened in new tab!`, 'success');
            }
            
            window.open(urls[platform], '_blank', 'width=600,height=400');
        }

        // Utility Functions
        function showStatus(elementId, message, type) {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
            statusElement.style.display = 'block';
            
            if (type === 'success' || type === 'info') {
                setTimeout(() => {
                    statusElement.style.display = 'none';
                }, 5000);
            }
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            
            // Add some entrance animations
            const sections = document.querySelectorAll('.section');
            sections.forEach((section, index) => {
                section.style.opacity = '0';
                section.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    section.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                    section.style.opacity = '1';
                    section.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });

        // Handle page visibility changes
        document.addEventListener('visibilitychange', function() {
            if (document.hidden && mediaRecorder && mediaRecorder.state === 'recording') {
                stopRecording();
            }
        });

        // Clean up resources when page unloads
        window.addEventListener('beforeunload', function() {
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
            }
        });
    </script>
</body>
</html>